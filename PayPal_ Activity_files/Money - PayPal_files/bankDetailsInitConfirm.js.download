define(["jquery","backbone","BaseView","view/overpanel/bank/bankDetailsConfirmDeposit","backboneSyphon"],function(e,t,n,r){"use strict";var i=n.extend({el:"#initConfirmPage",template:"bank/overpanel/bankDetailsInitConfirm",events:{"click .bankDetailsInitConfirm .confirmLater":"initiateConfirm","click .bankDetailsInitConfirm .removeBank":"showDeleteBankAlert"},showDeleteBankAlert:function(e){e.preventDefault(),this.alertView.showAlert("deleteBank",this.deleteBank.bind(this))},deleteBank:function(){t.trigger("toggleLoading",!0);var e=this.model.get("fiId"),n=new t.Model({fiId:e});n.set({id:e});var r=t.history.options.root+"banks/"+e;n.url=r,this.listenToOnce(n,"destroy",this.submitSuccess),this.listenToOnce(n,"error",this.submitError),n.destroy({wait:!0})},submitSuccess:function(e,n){t.trigger("toggleLoading",!1),t.trigger("closeAddBankOverpanel"),t.trigger("renderBanks")},submitError:function(e,n,r){t.trigger("toggleLoading",!1)},initiateConfirm:function(e){e.preventDefault(),t.trigger("toggleLoading",!0);var n=this.model.get("fiId"),r;r=r||new t.Model({fiId:n}),r.url=t.history.options.root+"banks/"+n+"/initiate-confirmation/"+this.$("input[name=confirmationMethod]").val(),this.listenToOnce(r,"sync",this.initiateConfirmSuccess),this.listenToOnce(r,"error",this.initiateConfirmError),r.save()},initiateConfirmSuccess:function(e,n){t.trigger("toggleLoading",!1),t.trigger("updateBankState",n.data.fiId,n.data.state),this.model.set({state:n.data.state}),this.bankDetailsConfirmDepositView?this.bankDetailsConfirmDepositView.model=this.model:this.bankDetailsConfirmDepositView=new r({model:this.model}),this.bankDetailsConfirmDepositView.setElement(this.$el).render()}});return i});