(function(e,t){typeof define=="function"&&define.amd?define([],t):typeof exports=="object"?module.exports=t():e.$clamp=t()})(this,function(){function e(e,t){function c(e,t){return r.getComputedStyle||(r.getComputedStyle=function(e,t){return this.el=e,this.getPropertyValue=function(t){var n=/(\-([a-z]){1})/g;return t=="float"&&(t="styleFloat"),n.test(t)&&(t=t.replace(n,function(){return arguments[2].toUpperCase()})),e.currentStyle&&e.currentStyle[t]?e.currentStyle[t]:null},this}),r.getComputedStyle(e,null).getPropertyValue(t)}function h(t){var n=t||e.clientHeight,r=d(e);return Math.max(Math.floor(n/r),0)}function p(t){var n=d(e);return n*t}function d(e){var t=c(e,"line-height");return t=="normal"&&(t=parseInt(c(e,"font-size"))*1.2),parseInt(t)}function b(t){return t.lastChild.children&&t.lastChild.children.length>0?b(Array.prototype.slice.call(t.children).pop()):!t.lastChild||!t.lastChild.nodeValue||t.lastChild.nodeValue===""||t.lastChild.nodeValue==i.truncationChar?(t.lastChild.parentNode.removeChild(t.lastChild),b(e)):t.lastChild}function w(t,n){function r(){v=i.splitOnChars.slice(0),m=v[0],g=null,y=null}if(!n)return;var s=t.nodeValue.replace(i.truncationChar,"");g||(v.length>0?m=v.shift():m="",g=s.split(m)),g.length>1?(y=g.pop(),E(t,g.join(m))):g=null,l&&(t.nodeValue=t.nodeValue.replace(i.truncationChar,""),e.innerHTML=t.nodeValue+" "+l.innerHTML+i.truncationChar);if(g){if(e.clientHeight<=n){if(!(v.length>=0&&m!==""))return e.innerHTML;E(t,g.join(m)+m+y),g=null}}else m===""&&(E(t,""),t=b(e),r());if(!i.animate)return w(t,n);setTimeout(function(){w(t,n)},i.animate===!0?10:i.animate)}function E(e,t){e.nodeValue=t+i.truncationChar}t=t||{};var n=this,r=window,i={clamp:t.clamp||2,useNativeClamp:typeof t.useNativeClamp!="undefined"?t.useNativeClamp:!0,splitOnChars:t.splitOnChars||[".","-","–","—"," "],animate:t.animate||!1,truncationChar:t.truncationChar||"…",truncationHTML:t.truncationHTML},s=e.style,o=e.innerHTML,u=typeof e.style.webkitLineClamp!="undefined",a=i.clamp,f=a.indexOf&&(a.indexOf("px")>-1||a.indexOf("em")>-1),l;i.truncationHTML&&(l=document.createElement("span"),l.innerHTML=i.truncationHTML);var v=i.splitOnChars.slice(0),m=v[0],g,y;a=="auto"?a=h():f&&(a=h(parseInt(a)));var S;if(u&&i.useNativeClamp)s.overflow="hidden",s.textOverflow="ellipsis",s.webkitBoxOrient="vertical",s.display="-webkit-box",s.webkitLineClamp=a,f&&(s.height=i.clamp+"px");else{var x=p(a);x<=e.clientHeight&&(S=w(b(e),x))}return{original:o,clamped:S}}return e});