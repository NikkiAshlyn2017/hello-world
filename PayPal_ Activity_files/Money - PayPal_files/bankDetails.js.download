define(["jquery","underscore","backbone","BaseView","widget/theoverpanel","view/overpanel/bank/bankDetailsConfirmDeposit","view/overpanel/bank/bankDetailsConfirmCode","view/overpanel/bank/bankDetailsInitConfirm","backboneSyphon"],function(e,t,n,r,i,s,o,u){"use strict";var a=r.extend({el:"#bankDetailsPage",template:"bank/overpanel/bankDetails",events:{"click .removeBank":"showDeleteBankAlert","click .resendConfirmCode":"resendConfirmCode",'submit form[name="bankDetails"]':"saveBankInfo","click .confirmBank":"startBankConfirmView"},initialize:function(e){},showDeleteBankAlert:function(e){e.preventDefault(),this.alertView.showAlert("deleteBank",this.deleteBank.bind(this))},deleteBank:function(){n.trigger("toggleLoading",!0);var e=this.model.get("fiId"),t=new n.Model({fiId:e});t.set({id:e});var r=n.history.options.root+"banks/"+e;t.url=r,this.listenToOnce(t,"destroy",this.submitSuccess),this.listenToOnce(t,"error",this.submitError),t.destroy({wait:!0})},submitSuccess:function(e,t){n.trigger("toggleLoading",!1),n.trigger("closeAddBankOverpanel"),n.trigger("renderBanks")},submitError:function(e,t,r){var i=t.error&&t.error.code;i&&i==="4054"&&(n.trigger("removeBankAndRenderBanks",this.model),this.$("input").prop("disabled",!0)),this.toggleLoading(!1),this.formView.showError(r)},startBankConfirmView:function(e){e.preventDefault();var t=this.model.get("confirmationMethod"),n=this.model.get("state");this.model.set({currencyFormat:{decimal:"."}}),n!=="initiate_confirmation"||t!=="double-deposit"&&t!=="paypal-code"?t==="paypal-code"?this.startView("bankConfirmCodeView",o):this.startView("bankConfirmDepositView",s):this.startView("bankInitConfirmDepositView",u)},startView:function(e,t){this[e]?this[e].model.set(this.model):this[e]=new t({model:this.model,bankDetailsView:this}),this[e].alertView=this.alertView,this[e].setElement(this.$el).render()},resendConfirmCode:function(e){e.preventDefault(),n.trigger("toggleLoading",!0);var t=this.model.get("fiId"),r=new n.Model({fiId:t});r.url=n.history.options.root+"banks/"+t+"/reinitiate-confirmation/numeric-code",this.listenToOnce(r,"sync",this.resendConfirmCodeSuccess),this.listenToOnce(r,"error",this.resendConfirmCodeError),r.save()},resendConfirmCodeSuccess:function(e,t){n.trigger("toggleLoading",!1),this.model.set({state:t.data.state}),this.alertView.showAlert("newCodeRequested",function(){n.trigger("closeAddBankOverpanel"),n.trigger("renderBanks")})},resendConfirmCodeError:function(e,t,r){n.trigger("toggleLoading",!1),n.trigger("showBankInfoError",{message:r,code:t.error.code})},removeServiceErrorMsg:function(){this.$(".alert").remove()},saveBankInfoError:function(e,t,r){n.trigger("toggleLoading",!1),n.trigger("trackError",{message:r,code:t.error.code}),this.showServiceErrorMsg(r)},showServiceErrorMsg:function(e){this.removeServiceErrorMsg(),this.$el.find(".overpanel-header").after(this.alertMsg.setMessage(e).el)}});return a});