define(["jquery","backbone","BaseView","widget/theoverpanel","widget/alertMsg","widget/validateForm","backboneSyphon"],function(e,t,n,r,i,s){"use strict";var o=n.extend({el:"#confirmPPCodePage",isBankDisabled:!1,template:"bank/overpanel/bankDetailsConfirmCode",events:{"click .confirmDeposits .cancel":"backToDEDetailsView","click .confirmDeposits .confirmCode":"confirmCode","click .bankDetailsConfirmCode .close":"closeOverpanel"},initialize:function(e){this.bankDetailsView=e.bankDetailsView,this.alertMsg=this.alertMsg||new i},afterRender:function(){this.$(".textInput").lap().textField(),this.formView=new s({el:'form[name="confirmDeposits"]'})},closeOverpanel:function(e){this.isBankDisabled===!0&&(e.preventDefault(),t.trigger("closeAddBankOverpanel"),t.trigger("renderBanks"))},confirmCode:function(e){e.preventDefault(),t.trigger("toggleLoading",!0);var n=this.model.get("fiId"),r;r=new t.Model({fiId:n}),r.url=t.history.options.root+"banks/"+n+"/complete-confirmation/numeric-code",this.listenTo(r,"sync",this.confirmCodeSuccess),this.listenTo(r,"error",this.submitError),r.save({currency:this.model.get("currency"),numericCode:this.$('input[name="numericCode"]').val()})},submitError:function(e,n,r){t.trigger("toggleLoading",!1),n.error.code==="MAXED_RND_DEPOSIT_TRIES"&&(this.isBankDisabled=!0,this.$("input").prop("disabled",!0)),this.showServiceErrorMsg(r)},showServiceErrorMsg:function(e){this.alertMsg=this.alertMsg||new i,this.removeServiceErrorMsg(),this.$el.find(".overpanel-header").after(this.alertMsg.setMessage(e).el)},removeServiceErrorMsg:function(){this.$(".alertMsg").remove()},confirmCodeSuccess:function(e,n){t.trigger("toggleLoading",!1),t.trigger("closeAddBankOverpanel"),t.trigger("renderBanks")},confirmCodeError:function(e,n,r){var i=n.error&&n.error.code;n.error.code==="MAXED_RND_DEPOSIT_TRIES"&&(this.isBankDisabled=!0,this.$("input").prop("disabled",!0)),t.trigger("toggleLoading",!1),t.trigger("showBankDetailsError",{message:r,code:n.error.code})},backToDEDetailsView:function(e){e.preventDefault(),this.bankDetailsView.render()}});return o});